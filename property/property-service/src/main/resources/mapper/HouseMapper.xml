<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.jsy.community.mapper.HouseMapper">

	<select id="getSubIdList" parameterType="java.util.List" resultType="Long">
		select id from t_house
		where pid in
		<foreach collection="list" item="item" separator="," open="(" close=")">
			#{item}
		</foreach>
	</select>

	<insert id="addHouse">
		insert into t_house (code,community_id,building,unit,floor,door,pid,type,comment)
		select #{houseEntity.code},#{houseEntity.communityId},#{houseEntity.building},#{houseEntity.unit},#{houseEntity.floor},#{houseEntity.door},#{houseEntity.pid},#{houseEntity.type},#{houseEntity.comment} from dual
		where EXISTS (select id from t_house where id = #{houseEntity.pid}) or #{houseEntity.pid} = 0
	</insert>
	<!-- 按社区id获取社区名称 和社区 房间数量 -->
	<select id="getCommunityNameAndUserAmountById"  resultType="java.util.HashMap">
		select c.name,(SELECT count(*) from t_house where community_id = c.id and type = 4) as communityUserNum from t_community as c where c.id = #{communityId}
	</select>

	<!-- 按社区ID获取 社区名称 社区用户名和社区用户uid -->
	<select id="getCommunityNameAndUserInfo"  resultMap="useNameInfoMap">
		select u.real_name,u.uid,c.name from t_user as u left join t_user_house as h on u.uid = h.uid JOIN t_community as c on h.community_id = c.id where h.community_id = #{communityId}
	</select>
	<resultMap id="useNameInfoMap" type="com.jsy.community.entity.UserEntity">
		<result column="real_name" property="realName"/>
		<result column="uid" property="uid"/>
		<!--由于实体字段信息并不会返回到前端，所以我这里直接用UserEntity的nickname字段来封装 社区名称-->
		<result column="name" property="nickname"/>
	</resultMap>

</mapper>
