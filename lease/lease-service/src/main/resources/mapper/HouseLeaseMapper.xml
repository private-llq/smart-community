<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jsy.lease.mapper.HouseLeaseMapper">


    <!-- 保存房屋租售信息 -->
    <insert id="insertHouseLease">
        insert into t_house_lease (id,uid,house_title,house_city_id,house_area_id,house_address,house_advantage_id,house_price,house_unit,house_square_meter,house_leasedeposit_id
        ,house_type_id,house_floor,house_direction,house_has_elevator,house_style_id,house_year,house_usage_id,house_kind_id
        ,house_introduce,house_image_id,house_leasetype_id,house_leasemode_id,house_contact,house_furniture_id,house_lon,house_lat
        )
        values
        (#{id},#{uid},#{houseTitle},#{houseCityId},#{houseAreaId},#{houseAddress},#{houseAdvantageId},#{housePrice},#{houseUnit},#{houseSquareMeter},#{houseLeasedepositId}
        ,#{houseTypeId},#{houseFloor},#{houseDirection},#{houseHasElevator},#{houseStyleId},#{houseYear},#{houseUsageId},#{houseKindId}
        ,#{houseIntroduce},#{houseImageId},#{houseLeasetypeId},#{houseLeaseymodeId},#{houseContact},#{houseFurnitureId},#{houseLon},#{houseLat}
        )
    </insert>



    <!-- 插入房屋图片至中间库 -->
    <insert id="insertHouseImages" >
        insert into t_house_leasesale_const(img_url,field_id,hid)
        values
        <foreach collection="houseLeaseQO.houseImage" item="item" separator=",">
            (#{item},#{houseLeaseQO.houseImageId},#{houseLeaseQO.id})
        </foreach>
    </insert>



    <!-- 删除用户t_house_lease表中的数据 -->
    <delete id="delHouseLeaseInfo">
        delete from t_house_lease where id = #{id}
    </delete>

    <!-- 按列表查询房屋出租信息 -->
    <select id="queryHouseLeaseByList" resultType="com.jsy.community.vo.HouseLeaseVO">
        select id,house_title,house_address,house_advantage_id,house_price,house_unit,house_square_meter,house_image_id,house_leasemode_id,house_type_id,house_lon,house_lat from t_house_lease
         <where>
            <!-- 如果查询筛选增加了市条件 -->
            <if test="query.houseAreaId != null and query.houseAreaId != &quot;&quot; and query.houseAreaId &gt; 0">
                    house_area_id = #{query.houseAreaId}
            </if>
             <!-- 如果增加了租金筛选条件 大于最小租金 小于最大租金 -->
             <if test="query.housePriceMin != null and query.housePriceMin != &quot;&quot; and query.housePriceMin &gt; 0
                and query.housePriceMax != null and query.housePriceMax != &quot;&quot; and query.housePriceMax &gt; 0">
                 and house_price &gt; #{query.housePriceMin} and house_price &lt; #{query.housePriceMax}
             </if>
             <!-- 如果增加了房屋面积筛选条件 大于最小房屋面积 小于最大房屋面积 -->
             <if test="query.houseSquareMeterMin != null and query.houseSquareMeterMin != &quot;&quot; and query.houseSquareMeterMin &gt; 0
                and query.houseSquareMeterMax != null and query.houseSquareMeterMax != &quot;&quot; and query.houseSquareMeterMax &gt; 0">
                 and house_square_meter &gt; #{query.houseSquareMeterMin} and house_square_meter &lt; #{query.houseSquareMeterMax}
             </if>
             <!-- 如果查询筛选增加了户型条件 几室几厅之类 -->
             <if test="query.houseTypeId != null and query.houseTypeId != &quot;&quot; and query.houseTypeId &gt; 0">
                 and house_type_id = #{query.houseTypeId}
             </if>
             <!-- 如果查询筛选增加了房屋类型条件 住宅、别墅、公寓之类 -->
             <if test="query.houseLeasetypeId != null and query.houseLeasetypeId != &quot;&quot; and query.houseLeasetypeId &gt; 0">
                 and house_leasetype_id = #{query.houseLeasetypeId}
             </if>
             <!-- 如果查询筛选增加了出租方式条件 整租、合租之类 -->
             <if test="query.houseLeaseymodeId != null and query.houseLeaseymodeId != &quot;&quot; and query.houseLeaseymodeId &gt; 0">
                 and house_leasemode_id = #{query.houseLeaseymodeId}
             </if>
             <!-- 如果查询筛选增加了房屋来源条件 个人、经纪人之类 -->
             <if test="query.houseSourceId != null and query.houseSourceId != &quot;&quot; and query.houseSourceId &gt; 0">
                 and house_source_id = #{query.houseSourceId}
             </if>
             <!-- 如果查询筛选增加了房源类型条件  精装修、邻地铁之类 -->
             <if test="query.houseAdvantage != null">
                 and house_advantage_id in
                 <foreach collection="query.houseAdvantage" item="houseConstCode" separator="," open="(" close=")">
                     #{houseConstCode}
                 </foreach>
             </if>
         </where>
         limit #{page},#{size}
    </select>

    <!-- 通过 常量id集合 查询 常量名称 -->
    <select id="queryHouseConstIdName" resultType="java.util.HashMap">
        select house_const_name,house_const_code from t_house_const where
        house_const_type = #{type}
        and house_const_code in
        <foreach collection="constIdList" item="code" separator="," open="(" close=")">
            #{code}
        </foreach>
    </select>

    <!-- 按家具id查出所有家具名称 -->
    <select id="queryHouseConstNameByFurnitureId" resultType="java.lang.String">
        select house_const_name from t_house_const where
        house_const_type = #{type}
        and house_const_code in
        <foreach collection="furnitureId" item="code" separator="," open="(" close=")">
            #{code}
        </foreach>
    </select>
</mapper>