<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jsy.community.mapper.RelationMapper">

<sql id="selectId">
        t.id,
        t.householder_id,
        t.community_id,
        t.house_id,
        t.name,
        t.sex,
        t.mobile,
        t.id_card,
        t.relation
</sql>
<!--  添加车辆  -->
    <insert id="addCars" parameterType="List">
        insert into t_car(id,uid,car_type,car_plate,contact,owner,community_id,house_member_id,driving_license_url)
        values
        <foreach collection="cars" item="item" separator=",">
            (#{item.id},#{item.uid},#{item.carType},#{item.carPlate},#{item.contact},#{item.owner},#{item.communityId},#{item.houseMemberId},#{item.drivingLicenseUrl})
        </foreach>
    </insert>
    <!--  通过id查询业主家属  -->
    <select id="selectID" resultType="com.jsy.community.entity.HouseMemberEntity">
        select <include refid="selectId"></include> from t_house_member t join t_user_house tu on t.householder_id=tu.uid
        where t.deleted=0 and tu.deleted=0 and t.house_id=tu.house_id and t.householder_id=#{id} and t.house_id=#{houseId}
    </select>
    <update id="updateUserRelationDetails" parameterType="com.jsy.community.qo.RelationQo">
        update t_house_member
        <set>
            <if test="name!=null and name!=''">
                name=#{name},
            </if>
            <if test="sex!=null and sex>0">
                sex=#{sex},
            </if>
             <if test="mobile!=null and mobile!=''">
                 mobile=#{mobile},
            </if>
            <if test="identificationType!=null and identificationType>0">
                identification_type=#{identificationType},
            </if>
            <if test="idCard!=null and idCard!=''">
                id_card=#{idCard},
            </if>
            <if test="relation!=null and relation>0">
                relation=#{relation},
            </if>
            <if test="communityId!=null and communityId>0">
                community_id=#{communityId},
            </if>
            <if test="houseId!=null and houseId>0">
                house_id=#{houseId}
            </if>
            where id=#{id}
        </set>
    </update>
    <update id="updateUserRelationCar" parameterType="com.jsy.community.qo.RelationCarsQo">
            update t_car
            <set>
                <if test="carPlate!=null and carPlate!=''">
                    car_plate=#{carPlate},
                </if>
                <if test="carType!=null and carType!=''">
                    car_type=#{carType},
                </if>
                <if test="drivingLicenseUrl!=null and drivingLicenseUrl!=''">
                    driving_license_url=#{drivingLicenseUrl},
                </if>
                <if test="owner!=null and owner!=''">
                    owner=#{owner},
                </if>
                <if test="communityId!=null and communityId>0">
                    community_id=#{communityId},
                </if>
            </set>
            where id=#{id}
    </update>
</mapper>