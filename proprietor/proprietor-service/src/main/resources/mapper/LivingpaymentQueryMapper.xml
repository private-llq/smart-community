<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jsy.community.mapper.LivingpaymentQueryMapper">
    <sql id="query">
        where t.deleted=0 and tg.deleted=0 and tpt.deleted=0 and tg.uid=#{userID}
        <if test="familyId!=null and familyId!=''">
            and t.family_id=#{familyId}
        </if>
        <if test="payYear!=null and payYear>0">
            and t.pay_year=#{payYear}
        </if>
        <if test="payMonth!=null and payMonth>0">
            and t.pay_month=#{payMonth}
        </if>
    </sql>

    <select id="selectList" resultMap="DefaultHouseOwnerMap">
        SELECT distinct
        pg.name as groupName,
        po.family_id as familyId,
        po.unit_id as companyId,
        po.unit as companyName,
        tt.icon as icon,
        tt.medium_icon as mediumIcon,
        tt.large_size_icon as largeSizeIcon,
        tt.id as typeID,
        tt.name as typeName,
        po.create_time as timeStart
        FROM t_pay_order po
        join t_pay_type tt on po.payment_type=tt.id
        join t_pay_group pg on po.group_id=pg.id
        where po.deleted=0 and tt.deleted=0 and pg.deleted=0  pg.uid=#{userId} ORDER BY timeStart desc limit #{page},#{size}
    </select>


    <select id="selectOrder" resultMap="PaymentRecordsVOMAP">
        SELECT
        concat(t.pay_year,"年",t.pay_month,"月") as timeGroup,
        t.id as id,t.pay_year as payYear,t.pay_month as payMonth,t.order_num as orderNum,t.company_name as companyName,
        t.family_id as familyId,t.order_time as orderTime,t.payment_balance paymentBalance,t.pay_type as payType,
        t.bill_classification as billClassification,t.tally as tally,t.remark as remark,t.remark_img as remarkImg,
        tpt.id as typeId,tpt.name as typeName,t.address as address,tpt.icon as icon,tpt.medium_icon as mediumIcon,tpt.large_size_icon as largeSizeIcon
        FROM t_pay_order t
        join t_pay_group tg on t.group_id=tg.id
        join t_pay_type tpt on t.payment_type=tpt.id
        <include refid="query"></include>
        ORDER BY orderTime desc
    </select>
    <select id="selectGroup" resultMap="GroupVOMap">
        SELECT distinct
        po.family_id as familyId,pc.id as typeId,pc.name as typeName,pg.id as groupId,pg.name as groupName
        FROM t_pay_order po
        join t_pay_type tt on po.type_id=tt.id
        join t_pay_group pg on po.group_id=pg.id
        JOIN t_pay_company pc on po.type_id=pc.id
        where tt.deleted=0 and pg.deleted=0 and pc.deleted=0 and po.deleted=0 and pg.uid=#{userId} and pg.name=#{groupName}
    </select>
    <select id="selectGroupAll" resultMap="GroupVOMap">
        SELECT distinct
        tg.name as groupName,
        ph.family_id as familyId,
		pc.id as typeId,
		pc.name as typeName,
        pt.id as companyId,
		pt.name as companyName
        FROM t_pay_family ph
		JOIN t_pay_company pc on ph.pay_company=pc.id
		JOIN t_pay_type pt on ph.type=pt.id
		join t_pay_group tg on tg.id=ph.group_id
        where tg.deleted=0 and ph.deleted=0 and ph.uid=#{userID}
    </select>
    <select id="selectPaymentDetailsVO" resultType="com.jsy.community.vo.livingpayment.PaymentDetailsVO">
        SELECT
        id,
        company_name as companyName,
        family_id as familyId,
        order_time as orderTime,
        arrive_time as arriveTime,
        payment_balance as paymentBalance,
        account_balance as accountBalance,
        address as address,
        status as status,
        family_name as familyName
        FROM t_pay_order
        where deleted=0 and id=#{id}
    </select>
    <select id="findGroup" resultType="com.jsy.community.entity.PayGroupEntity">
        select id,uid,name,type from t_pay_group where deleted=0 and uid=#{userId}
    </select>
    <select id="selectOrderId" resultType="com.jsy.community.vo.livingpayment.TheBillingDetailsVO">
        SELECT
        t.id as id,t.pay_type as payType,tp.name as typeName,
        tp.icon as icon,tp.medium_icon as mediumIcon,
        tp.large_size_icon as largeSizeIcon,t.company_name as companyName,
        t.payment_balance as paymentBalance,t.status as status,t.family_id as familyId,
        t.order_num as orderNum,t.bill_classification as billClassification,
        t.tally as tally,t.remark as remark,t.remark_img as remarkImg
        FROM t_pay_order t JOIN t_pay_type tp on t.type_id=tp.id
        where t.deleted=0 and tp.deleted=0 and t.id=#{id}
    </select>

    <resultMap id="GroupVOMap" type="com.jsy.community.vo.livingpayment.GroupVO">
        <result property="typeName" column="typeName"/>
        <result property="typeId" column="typeID"/>
        <result property="groupName" column="groupName"/>
        <result property="familyId" column="familyId"/>
        <result property="groupId" column="groupId"/>
        <result property="companyId" column="companyId"/>
        <result property="companyName" column="companyName"/>
    </resultMap>

    <resultMap id="DefaultHouseOwnerMap" type="com.jsy.community.vo.livingpayment.DefaultHouseOwnerVO">
        <result property="groupId" column="groupId"/>
        <result property="groupName" column="groupName"/>
        <result property="familyId" column="familyId"/>
        <result property="companyId" column="companyId"/>
        <result property="companyName" column="companyName"/>
        <result property="typeId" column="typeId"/>
        <result property="typeName" column="typeName"/>
        <result property="icon" column="icon"/>
        <result property="mediumIcon" column="mediumIcon"/>
        <result property="largeSizeIcon" column="largeSizeIcon"/>
    </resultMap>

    <resultMap id="PaymentRecordsVOMAP" type="com.jsy.community.vo.livingpayment.PaymentRecordsVO">
        <result property="id" column="id"/>
        <result column="payYear" property="payYear"/>
        <result column="payMonth" property="payMonth"/>
        <result column="payType" property="payType"/>
        <result column="paymentBalance" property="paymentBalance"/>
        <result column="companyName" property="companyName"/>
        <result column="icon" property="icon"/>
        <result column="address" property="address"/>
        <result column="familyId" property="familyId"/>
        <result column="orderNum" property="orderNum"/>
        <result column="orderTime" property="orderTime"/>
        <result column="billClassification" property="billClassification"/>
        <result column="tally" property="tally"/>
        <result column="remark" property="remark"/>
        <result column="remarkImg" property="remarkImg"/>
        <result column="typeId" property="typeId"/>
        <result column="typeName" property="typeName"/>
        <result column="timeGroup" property="timeGroup"/>
    </resultMap>
</mapper>