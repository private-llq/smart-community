<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jsy.community.mapper.ProprietorMarketMapper">
   <resultMap id="ProprietorMarketEntityMap" type="com.jsy.community.entity.proprietor.ProprietorMarketEntity">
       <result column="id" property="id"/>
       <result column="communityId" property="communityId"/>
       <result column="uid" property="uid"></result>
       <result column="createTime" property="createTime"></result>
       <result column="updateTime" property="updateTime"></result>
       <result column="deleted" property="deleted"></result>
       <result column="state" property="state"></result>

       <result column="goodsName" property="goodsName"></result>
       <result column="price" property="price"></result>
       <result column="goodsExplain" property="goodsExplain"></result>
       <result column="negotiable" property="negotiable"></result>
       <result column="labelId" property="labelId"></result>
       <result column="categoryId" property="categoryId"></result>
       <result column="click" property="click"></result>
       <result column="phone" property="phone"></result>
       <result column="images" property="images"></result>
       <result column="shield" property="shield"></result>

       <result column="labelName" property="labelName"></result>
       <result column="categoryName" property="categoryName"></result>

   </resultMap>

    <!--当前用户发布的商品-->
    <select id="selectMarketPage" resultMap="ProprietorMarketEntityMap">
        select tm.id, tm.community_id , tm.uid, tm.goods_name as goodsName, tm.price, tm.goods_explain as goodsExplain,
               tm.negotiable,  tm.state, tm.category_id as categoryId,tm.label_id as labelId,
               tm.click as click, tm.phone as phone,tm.images as images,tm.shield as shield,
               tm.deleted as deleted, tm.create_time as createTime,tm.update_time as updateTime,
               tpml.label as labelName,tpmc.category  as categoryName
        from t_proprietor_market tm
        left join t_proprietor_market_category tpmc on tm.category_id = tpmc.category_id
        left join t_proprietor_market_label tpml on tm.label_id = tpml.label_id
            where tm.deleted = 0
            and tm.state = #{query.state}
            and tm.uid = #{query.uid}
        limit #{page},#{size}
    </select>

    <!--当前用户发布的条数-->
    <select id="findTotal" resultType="java.lang.Long">
        select count(*) from t_proprietor_market tm
        where tm.deleted = 0
          and tm.state =#{query.state}
          and tm.uid = #{query.uid}

    </select>


    <!--所有发布商品的条数-->
    <select id="findTotals" resultType="java.lang.Long">
        select count(*) from t_proprietor_market tm
        where tm.deleted = 0
          and tm.state =1
          and tm.category_id=#{query.categoryId}
          and tm.shield= 0
    </select>

    <!--所有发布商品-->
    <select id="selectMarketAllPage" resultType="com.jsy.community.qo.proprietor.ProprietorMarketQO">
        select tm.id, tm.community_id , tm.uid, tm.goods_name as goodsName, tm.price, tm.goods_explain as goodsExplain,
               tm.negotiable,  tm.state, tm.category_id as categoryId,tm.label_id as labelId,
               tm.click as click, tm.phone as phone,tm.images as images,tm.shield as shield,
               tm.deleted as deleted, tm.create_time as createTime,tm.update_time as updateTime,
               tpml.label as labelName,tpmc.category  as categoryName
        from t_proprietor_market tm
                 left join t_proprietor_market_category tpmc on tm.category_id = tpmc.category_id
                 left join t_proprietor_market_label tpml on tm.label_id = tpml.label_id
        where tm.deleted = 0
          and tm.state = 1
          and tm.category_id=#{query.categoryId}
          and tm.shield= 0
        limit #{page},#{size}
    </select>
    <select id="findLikeTotals" resultType="java.lang.Long">
        select count(*) from t_proprietor_market tm
        where tm.deleted = 0
          and tm.state =1
          and tm.shield= 0
    </select>

    <select id="selectMarketLikePage" resultType="com.jsy.community.qo.proprietor.ProprietorMarketQO">
        select tm.id, tm.community_id , tm.uid, tm.goods_name as goodsName, tm.price, tm.goods_explain as goodsExplain,
               tm.negotiable,  tm.state, tm.category_id as categoryId,tm.label_id as labelId,
               tm.click as click, tm.phone as phone,tm.images as images,tm.shield as shield,
               tm.deleted as deleted, tm.create_time as createTime,tm.update_time as updateTime,
               tpml.label as labelName,tpmc.category  as categoryName
        from t_proprietor_market tm
                 left join t_proprietor_market_category tpmc on tm.category_id = tpmc.category_id
                 left join t_proprietor_market_label tpml on tm.label_id = tpml.label_id
        where tm.deleted = 0
          and tm.state = 1
          and tm.shield= 0
        order by tm.click desc
        limit #{page},#{size}
    </select>

</mapper>